name: Android CI

on:
  push:
    paths-ignore:
      - '**/README.md'
      - '**/doc-dev/*'
    branches:
      - 'main'
      - 'release-*'
      - '*-feature-*'
      - '*-enhancement-*'
      - '*-hotfix-*'
      - '*-bug-*'
      - '*-documentation-*'
      - 'BF-*'
      - 'FE-*'
      - 'PU-*'
      - 'DOC-*'
    tags:
      - '*' # Push events to matching *, i.e. 1.0.0 v1.0, v20.15.10
  pull_request:
    paths-ignore:
      - '**/README.md'
    types: # https://docs.github.com/actions/using-workflows/events-that-trigger-workflows#pull_request
      - opened
      - reopened
      - closed
    # branches:
    #   - 'main'
    #   - 'release-*'
    #   - 'DOC-*'
    #   - 'hotfix-*'

jobs:
  build:
    strategy:
      matrix:
        jdk:
         - '17'
        os:
          # - macos-latest
          # - windows-latest
          - ubuntu-latest
    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v4
    - name: set up JDK ${{ matrix.jdk }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ matrix.jdk }}
        distribution: 'temurin'
        cache: gradle

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build init with Gradle
      run: ./gradlew clean buildEnvironment --warning-mode all
    - name: Build test with Gradle
      run: |
        ./gradlew plugin:test
        ./gradlew demo:test
    - name: Build test coverage with Gradle
      run: |
        ./gradlew plugin:jacocoDebugReport
    - name: Build assemble debug with Gradle
      run: |
        ./gradlew plugin:assembleDebug
        ./gradlew demo:assembleDebug
